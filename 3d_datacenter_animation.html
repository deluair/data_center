<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5GW AI Data Center - 3D Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            color: #eee;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #visualization {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(ellipse at center, #0a1a2a 0%, #000000 100%);
        }

        .ui-panel {
            position: absolute;
            z-index: 100;
            background: rgba(10, 20, 30, 0.85);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #00aaff;
            box-shadow: 0 0 25px rgba(0, 170, 255, 0.3), inset 0 0 10px rgba(0, 170, 255, 0.2);
            backdrop-filter: blur(12px);
            color: #00d9ff;
        }

        #info {
            top: 20px;
            left: 20px;
            max-width: 350px;
        }

        #controls {
            bottom: 20px;
            left: 20px;
        }

        .metric {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .value {
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
        }

        button {
            background: linear-gradient(145deg, #00aaff, #0077cc);
            color: #fff;
            border: 1px solid #00d9ff;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 170, 255, 0.2);
            text-transform: uppercase;
        }

        button:hover {
            background: linear-gradient(145deg, #00c3ff, #0088dd);
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 170, 255, 0.4);
        }

        .rack {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .rack:hover {
            filter: url(#glow);
        }

        .server-light {
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .cooling-flow {
            animation: flow 2s linear infinite;
        }

        @keyframes flow {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -40; }
        }

        .power-line {
            animation: electricity 1s linear infinite;
        }

        @keyframes electricity {
            0% { filter: brightness(1.2); }
            50% { filter: brightness(2) drop-shadow(0 0 8px #ffdd00); }
            100% { filter: brightness(1.2); }
        }

        #tooltip {
            position: absolute;
            display: none;
            background: rgba(20, 30, 40, 0.9);
            border: 1px solid #00d9ff;
            border-radius: 8px;
            padding: 15px;
            color: #fff;
            font-size: 12px;
            pointer-events: none;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
            backdrop-filter: blur(8px);
            transition: opacity 0.2s;
        }

        .tooltip-title {
            font-weight: bold;
            color: #00d9ff;
            margin-bottom: 8px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="container">
        <div id="visualization"></div>
        <div id="info" class="ui-panel">
            <h2>5GW AI Data Center - Real-Time Metrics</h2>
            <div class="metric">Performance: <span id="performance" class="value">...</span> TFLOPS</div>
            <div class="metric">Power Consumption: <span id="power" class="value">...</span> MW</div>
            <div class="metric">Active GPUs: <span id="gpus" class="value">...</span></div>
            <div class="metric">Active Racks: <span id="racks" class="value">...</span> / 500</div>
            <div class="metric">Avg. Utilization: <span id="utilization" class="value">...</span>%</div>
            <div class="metric">PUE: <span id="pue" class="value">...</span></div>
            <div class="metric">Avg. Temp: <span id="temp" class="value">...</span>Â°C</div>
        </div>
        <div id="controls" class="ui-panel">
            <button id="toggle-animation">Pause Animation</button>
            <button id="change-view">Change View</button>
            <button id="toggle-workload">Toggle Workload</button>
            <button id="toggle-cooling">Toggle Cooling</button>
        </div>
        <div id="tooltip"></div>
    </div>

    <svg width="0" height="0" style="position:absolute">
        <defs>
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="5.5" result="coloredBlur"></feGaussianBlur>
                <feMerge>
                    <feMergeNode in="coloredBlur"></feMergeNode>
                    <feMergeNode in="SourceGraphic"></feMergeNode>
                </feMerge>
            </filter>
        </defs>
    </svg>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script>
        // Global variables
        let svg, width, height;
        let animationRunning = true;
        let currentView = 0;
        let workloadActive = true;
        let coolingActive = true;
        let rotationAngle = 0;
        let zoomLevel = 1;
        
        // Data center configuration
        const datacenterConfig = {
            racks: 111550,
            servers: 446200,
            gpus: 3570000,
            powerMW: 3042,
            performanceExaFLOPS: 5597,
            utilization: 68.2,
            pue: 1.250,
            temperature: 22
        };
        
        // Initialize the visualization
        function init() {
            const container = d3.select('#visualization');
            width = window.innerWidth;
            height = window.innerHeight;
            
            svg = container.append('svg')
                .attr('width', width)
                .attr('height', height)
                .style('background', 'radial-gradient(circle at center, #001122, #000011)')
                .call(d3.drag()
                    .on('drag', handleDrag))
                .call(d3.zoom()
                    .scaleExtent([0.5, 3])
                    .on('zoom', handleZoom));
            
            // Create main group for transformations
            const mainGroup = svg.append('g')
                .attr('id', 'main-group')
                .attr('transform', `translate(${width/2}, ${height/2})`);
            
            // Create data center layout
            createDataCenterLayout(mainGroup);
            
            // Start animation loop
            animate();
            
            // Update metrics periodically
            setInterval(updateMetrics, 2000);
        }
        
        function createDataCenterLayout(group) {
            // Create floor grid
            createFloorGrid(group);
            
            // Create server racks
            createServerRacks(group);
            
            // Create cooling systems
            createCoolingSystems(group);
            
            // Create power infrastructure
            createPowerInfrastructure(group);
            
            // Create network connections
            createNetworkConnections(group);
        }
        
        function createFloorGrid(group) {
            const gridGroup = group.append('g').attr('class', 'floor-grid');
            
            // Create grid lines
            for (let i = -400; i <= 400; i += 40) {
                gridGroup.append('line')
                    .attr('x1', i)
                    .attr('y1', -300)
                    .attr('x2', i)
                    .attr('y2', 300)
                    .attr('stroke', '#003366')
                    .attr('stroke-width', 0.5)
                    .attr('opacity', 0.3);
                    
                gridGroup.append('line')
                    .attr('x1', -400)
                    .attr('y1', i)
                    .attr('x2', 400)
                    .attr('y2', i)
                    .attr('stroke', '#003366')
                    .attr('stroke-width', 0.5)
                    .attr('opacity', 0.3);
            }
        }
        
        function createServerRacks(group) {
            const racksGroup = group.append('g').attr('class', 'server-racks');
            
            // Create rack rows
            const rackRows = 20;
            const racksPerRow = 25;
            const rackWidth = 12;
            const rackHeight = 8;
            const rackSpacing = 16;
            
            for (let row = 0; row < rackRows; row++) {
                for (let col = 0; col < racksPerRow; col++) {
                    const x = (col - racksPerRow/2) * rackSpacing;
                    const y = (row - rackRows/2) * rackSpacing;
                    
                    const rackGroup = racksGroup.append('g')
                        .attr('class', 'rack')
                        .attr('transform', `translate(${x}, ${y})`);
                    
                    // Rack body
                    rackGroup.append('rect')
                        .attr('x', -rackWidth/2)
                        .attr('y', -rackHeight/2)
                        .attr('width', rackWidth)
                        .attr('height', rackHeight)
                        .attr('fill', '#2a4d3a')
                        .attr('stroke', '#00ff88')
                        .attr('stroke-width', 0.5)
                        .attr('rx', 1);
                    
                    // Server lights
                    for (let i = 0; i < 4; i++) {
                        rackGroup.append('circle')
                            .attr('class', 'server-light')
                            .attr('cx', -rackWidth/2 + 2 + i * 2.5)
                            .attr('cy', 0)
                            .attr('r', 0.8)
                            .attr('fill', workloadActive ? '#00ff88' : '#004422')
                            .style('animation-delay', `${Math.random() * 2}s`);
                    }
                    
                    // Add click interaction
                    rackGroup.on('click', function() {
                        showRackDetails(row, col);
                    });
                }
            }
        }
        
        function createCoolingSystems(group) {
            const coolingGroup = group.append('g').attr('class', 'cooling-systems');
            
            // Cooling units
            const coolingUnits = [
                {x: -350, y: -250, type: 'chiller'},
                {x: 350, y: -250, type: 'chiller'},
                {x: -350, y: 250, type: 'cooling-tower'},
                {x: 350, y: 250, type: 'cooling-tower'}
            ];
            
            coolingUnits.forEach(unit => {
                const unitGroup = coolingGroup.append('g')
                    .attr('transform', `translate(${unit.x}, ${unit.y})`);
                
                // Unit body
                unitGroup.append('rect')
                    .attr('x', -20)
                    .attr('y', -15)
                    .attr('width', 40)
                    .attr('height', 30)
                    .attr('fill', unit.type === 'chiller' ? '#0066cc' : '#cc6600')
                    .attr('stroke', '#ffffff')
                    .attr('stroke-width', 1)
                    .attr('rx', 3);
                
                // Cooling flow animation
                if (coolingActive) {
                    unitGroup.append('path')
                        .attr('class', 'cooling-flow')
                        .attr('d', 'M-15,-10 Q0,-20 15,-10 Q0,0 -15,-10')
                        .attr('fill', 'none')
                        .attr('stroke', '#00ccff')
                        .attr('stroke-width', 2)
                        .attr('stroke-dasharray', '5,5')
                        .attr('opacity', 0.7);
                }
            });
        }
        
        function createPowerInfrastructure(group) {
            const powerGroup = group.append('g').attr('class', 'power-infrastructure');
            
            // Power distribution units
            const pduPositions = [
                {x: -300, y: 0},
                {x: 300, y: 0},
                {x: 0, y: -200},
                {x: 0, y: 200}
            ];
            
            pduPositions.forEach(pos => {
                const pduGroup = powerGroup.append('g')
                    .attr('transform', `translate(${pos.x}, ${pos.y})`);
                
                // PDU body
                pduGroup.append('rect')
                    .attr('x', -8)
                    .attr('y', -25)
                    .attr('width', 16)
                    .attr('height', 50)
                    .attr('fill', '#ffaa00')
                    .attr('stroke', '#ffffff')
                    .attr('stroke-width', 1)
                    .attr('rx', 2);
                
                // Power lines
                pduGroup.append('line')
                    .attr('class', 'power-line')
                    .attr('x1', 0)
                    .attr('y1', -25)
                    .attr('x2', 0)
                    .attr('y2', -50)
                    .attr('stroke', '#ffaa00')
                    .attr('stroke-width', 3)
                    .attr('opacity', 0.8);
            });
        }
        
        function createNetworkConnections(group) {
            const networkGroup = group.append('g').attr('class', 'network-connections');
            
            // Create network spine
            const spineData = [
                {x1: -200, y1: 0, x2: 200, y2: 0},
                {x1: 0, y1: -150, x2: 0, y2: 150}
            ];
            
            spineData.forEach(line => {
                networkGroup.append('line')
                    .attr('x1', line.x1)
                    .attr('y1', line.y1)
                    .attr('x2', line.x2)
                    .attr('y2', line.y2)
                    .attr('stroke', '#ff6600')
                    .attr('stroke-width', 2)
                    .attr('opacity', 0.6)
                    .attr('stroke-dasharray', '10,5');
            });
        }
        
        function animate() {
            if (animationRunning) {
                rotationAngle += 0.5;
                
                // Rotate the main visualization
                d3.select('#main-group')
                    .transition()
                    .duration(50)
                    .attr('transform', `translate(${width/2}, ${height/2}) rotate(${rotationAngle * 0.1}) scale(${zoomLevel})`);
                
                // Update server lights
                d3.selectAll('.server-light')
                    .attr('fill', () => {
                        const intensity = Math.random();
                        return workloadActive ? 
                            `hsl(120, 100%, ${50 + intensity * 30}%)` : 
                            '#004422';
                    });
                
                // Update cooling flow
                d3.selectAll('.cooling-flow')
                    .style('display', coolingActive ? 'block' : 'none');
            }
            
            requestAnimationFrame(animate);
        }
        
        function updateMetrics() {
            // Simulate real-time metrics
            const baseUtilization = 68.2;
            const utilization = baseUtilization + (Math.random() - 0.5) * 10;
            
            const basePower = 3042;
            const power = basePower + (Math.random() - 0.5) * 200;
            
            const baseTemp = 22;
            const temperature = baseTemp + (Math.random() - 0.5) * 4;
            
            const basePUE = 1.250;
            const pue = basePUE + (Math.random() - 0.5) * 0.1;
            
            // Update display
            d3.select('#utilization').text(`${utilization.toFixed(1)}%`);
            d3.select('#power').text(`${power.toFixed(0)} MW`);
            d3.select('#temperature').text(`${temperature.toFixed(1)}Â°C`);
            d3.select('#pue').text(pue.toFixed(3));
        }
        
        function handleDrag(event) {
            rotationAngle += event.dx * 0.5;
        }
        
        function handleZoom(event) {
            zoomLevel = event.transform.k;
            d3.select('#main-group')
                .attr('transform', `translate(${width/2}, ${height/2}) rotate(${rotationAngle * 0.1}) scale(${zoomLevel})`);
        }
        
        function showRackDetails(row, col) {
            const rackId = `R${row.toString().padStart(2, '0')}-${col.toString().padStart(2, '0')}`;
            // This function is now handled by the tooltip mouseover
        }
        
        // Control functions
        function toggleAnimation() {
            animationRunning = !animationRunning;
        }
        
        function changeView() {
            currentView = (currentView + 1) % 4;
            const views = [
                {rotation: 0, scale: 1},
                {rotation: 45, scale: 1.2},
                {rotation: 90, scale: 0.8},
                {rotation: 135, scale: 1.5}
            ];
            
            const view = views[currentView];
            rotationAngle = view.rotation;
            zoomLevel = view.scale;
        }
        
        function toggleWorkload() {
            workloadActive = !workloadActive;
        }
        
        function toggleCooling() {
            coolingActive = !coolingActive;
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            svg.attr('width', width).attr('height', height);
            d3.select('#main-group')
                .attr('transform', `translate(${width/2}, ${height/2}) rotate(${rotationAngle * 0.1}) scale(${zoomLevel})`);
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);

        // Add mouseover, mousemove, and mouseout events to the rack groups
        function createServerRacks(group) {
            const racksGroup = group.append('g').attr('class', 'server-racks');
            
            // Create rack rows
            const rackRows = 20;
            const racksPerRow = 25;
            const rackWidth = 12;
            const rackHeight = 8;
            const rackSpacing = 16;
            
            for (let row = 0; row < rackRows; row++) {
                for (let col = 0; col < racksPerRow; col++) {
                    const x = (col - racksPerRow/2) * rackSpacing;
                    const y = (row - rackRows/2) * rackSpacing;
                    
                    const rackGroup = racksGroup.append('g')
                        .attr('class', 'rack')
                        .attr('transform', `translate(${x}, ${y})`)
                        .on("mouseover", function(event, d) {
                            d3.select(this).raise();
                            tooltip.style("display", "block");
                        })
                        .on("mousemove", function(event, d) {
                            tooltip
                                .style("left", (event.pageX + 15) + "px")
                                .style("top", (event.pageY - 28) + "px")
                                .html(`
                                    <div class="tooltip-title">Rack ${row}-${col}</div>
                                    <div><strong>Status:</strong> Active</div>
                                    <div><strong>Workload:</strong> ${(Math.random() * 100).toFixed(2)}%</div>
                                    <div><strong>Temp:</strong> ${(Math.random() * 10 + 20).toFixed(2)}Â°C</div>
                                    <div><strong>Power:</strong> ${(Math.random() * 5).toFixed(2)} kW</div>
                                `);
                        })
                        .on("mouseout", function(event, d) {
                            tooltip.style("display", "none");
                        })
                        .on("click", (event, d) => {
                            // Future click functionality can be added here, e.g., zoom to rack
                            console.log(`Clicked Rack ID: ${row}-${col}`);
                        });
                    
                    // Rack body
                    rackGroup.append('rect')
                        .attr('x', -rackWidth/2)
                        .attr('y', -rackHeight/2)
                        .attr('width', rackWidth)
                        .attr('height', rackHeight)
                        .attr('fill', '#2a4d3a')
                        .attr('stroke', '#00ff88')
                        .attr('stroke-width', 0.5)
                        .attr('rx', 1);
                    
                    // Server lights
                    for (let i = 0; i < 4; i++) {
                        rackGroup.append('circle')
                            .attr('class', 'server-light')
                            .attr('cx', -rackWidth/2 + 2 + i * 2.5)
                            .attr('cy', 0)
                            .attr('r', 0.8)
                            .attr('fill', workloadActive ? '#00ff88' : '#004422')
                            .style('animation-delay', `${Math.random() * 2}s`);
                    }
                }
            }
        }
    </script>
</body>
</html>